DECLARE
    l_file_uploaded VARCHAR2(255);
BEGIN
    -- Get uploaded file name from APEX temp files
    SELECT filename
      INTO l_file_uploaded
      FROM apex_application_temp_files
     WHERE name = :P1039_FILE_BROWSE
       AND application_id = :APP_ID
       AND rownum = 1;

    -- 1) File not selected
    IF l_file_uploaded IS NULL THEN
        RAISE_APPLICATION_ERROR(-20001, 'Please upload a file before submitting.');
    END IF;

    -- 2) File name mismatch with page item (typed/assigned name)
    IF UPPER(TRIM(l_file_uploaded)) <> UPPER(TRIM(:P1039_FILE_NAME)) THEN
        RAISE_APPLICATION_ERROR(-20002, 'Uploaded file name does not match the expected file name.');
    END IF;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RAISE_APPLICATION_ERROR(-20001, 'Please upload a valid file before submitting.');
END;