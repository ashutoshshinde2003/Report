DECLARE
    l_db_file   VARCHAR2(255);
    l_count     NUMBER;
BEGIN
    -- Expected file name from page item
    IF :P1039_FILE_NAME IS NULL THEN
       raise_application_error(-20001, 'Please provide the expected file name.');
    END IF;

    -- Check if the file exists in APEX temp table
    SELECT COUNT(*)
      INTO l_count
      FROM apex_application_temp_files
     WHERE application_id = :APP_ID
       AND UPPER(TRIM(filename)) = UPPER(TRIM(:P1039_FILE_NAME));

    -- If file not found in APEX temp table → error
    IF l_count = 0 THEN
        raise_application_error(
            -20002,
            'File not uploaded or filename mismatch! Expected file: ' || :P1039_FILE_NAME
        );
    END IF;

    -- ✅ If exists, get the filename from temp table and continue
    SELECT filename
      INTO l_db_file
      FROM apex_application_temp_files
     WHERE application_id = :APP_ID
       AND UPPER(TRIM(filename)) = UPPER(TRIM(:P1039_FILE_NAME))
       AND ROWNUM = 1;

    -- Assign to variable used later in your script
    l_file_name := l_db_file;

END;