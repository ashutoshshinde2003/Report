SELECT *
FROM TABLE(
    apex_data_parser.parse(
        p_content   => (SELECT blob_content
                        FROM apex_application_temp_files
                        WHERE name = :P1_FILE),  -- uploaded file
        p_file_name => (SELECT filename
                        FROM apex_application_temp_files
                        WHERE name = :P1_FILE),
        p_skip_rows => 1  -- skip header row if needed
    )
)



SELECT name, filename, created_on 
FROM apex_application_temp_files
ORDER BY created_on DESC;


SELECT
    col001 AS job_id,
    col002 AS submission,
    TO_DATE(col003, 'DD/MM/YYYY') AS date_added,
    col004 AS status,
    col005 AS user_added
FROM TABLE(
    apex_data_parser.parse(
        p_content   => (SELECT blob_content
                        FROM apex_application_temp_files
                        WHERE name = :P1_FILE),
        p_file_name => (SELECT filename
                        FROM apex_application_temp_files
                        WHERE name = :P1_FILE),
        p_skip_rows => 1
    )
)



DECLARE
    l_blob      BLOB;
    l_filename  VARCHAR2(255);
BEGIN
    SELECT blob_content, filename
    INTO   l_blob, l_filename
    FROM apex_application_temp_files
    WHERE name = :P1_FILE_UPLOAD;

    FOR rec IN (
        SELECT *
        FROM TABLE(
            apex_data_parser.parse(
                p_content   => l_blob,
                p_file_name => l_filename,
                p_skip_rows => 1
            )
        )
    )
    LOOP
        INSERT INTO my_temp_table (
            job_id,
            submission,
            date_added,
            status,
            user_added
        )
        VALUES (
            rec.col001,
            rec.col002,
            rec.col003,
            rec.col004,
            rec.col005
        );
    END LOOP;
END;







begin
    -- Clear previous preview collection
    if apex_collection.collection_exists('EXCEL_PREVIEW') then
        apex_collection.delete_collection('EXCEL_PREVIEW');
    end if;

    apex_collection.create_collection('EXCEL_PREVIEW');

    -- Parse the uploaded Excel file
    for r in (
        select * from table(
            apex_data_parser.parse(
                p_content   => :P1_FILE_UPLOAD,
                p_file_name => :P1_FILE_UPLOAD_FILENAME
            )
        )
    ) loop
        -- Insert each row into the collection
        apex_collection.add_member(
            p_collection_name => 'EXCEL_PREVIEW',
            p_c001 => r.column_values(1),
            p_c002 => r.column_values(2),
            p_c003 => r.column_values(3)
        );
    end loop;
end;