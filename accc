DECLARE
    l_job_id NUMBER;
BEGIN
    -- Get job_id from page item
    l_job_id := :P5_JOB_ID;

    -- Safety check
    IF l_job_id IS NULL THEN
        raise_application_error(-20001, 'No job_id provided.');
    END IF;

    -- Delete rows with that job_id
    DELETE FROM bulk_resolution_data1
    WHERE job_id = l_job_id;

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('Deleted rows for JOB_ID=' || l_job_id);
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error deleting rows: ' || SQLERRM);
        raise;
END;





SELECT 
    job_id,
    submission,
    date_added,
    status,
    user_added,

    -- Virtual column with Cancel button
    '<button class="t-Button t-Button--danger t-Button--small" '||
    'onclick="apex.submit({request: ''CANCEL_'||job_id||'''});return false;">Cancel</button>' 
    AS cancel_button

FROM bulk_resolution_data
ORDER BY job_id DESC





SELECT 
    job_id,
    submission,
    date_added,
    status,
    user_added,

    -- Virtual column with Cancel button
    '<button class="t-Button t-Button--danger t-Button--small" 
        onclick="apex.item(''P5_JOB_ID'').setValue('||job_id||');
                 apex.submit({request:''CANCEL_ROW''});return false;">Cancel</button>' 
    AS cancel_button

FROM bulk_resolution_data
ORDER BY job_id DESC







BEGIN
  DELETE FROM bulk_resolution_data1
   WHERE job_id = :P5_JOB_ID;

  DELETE FROM bulk_resolution_data
   WHERE job_id = :P5_JOB_ID;

  COMMIT;

  APEX_DEBUG.MESSAGE('Deleted JOB_ID='||:P5_JOB_ID);
EXCEPTION
  WHEN OTHERS THEN
    APEX_DEBUG.ERROR('Error deleting JOB_ID='||:P5_JOB_ID||' - '||SQLERRM);
    RAISE;
END;





SELECT 
    job_id,
    submission,
    date_added,
    status,
    user_added,

    -- Virtual column with Cancel link (no submit yet)
    '<button class="t-Button t-Button--danger t-Button--small cancel-row" 
        data-jobid="'||job_id||'">Cancel</button>' 
    AS cancel_button
FROM bulk_resolution_data
ORDER BY job_id DESC




BEGIN
  DELETE FROM bulk_resolution_data1
   WHERE job_id = :P5_JOB_ID;

  DELETE FROM bulk_resolution_data
   WHERE job_id = :P5_JOB_ID;

  COMMIT;
END;






SELECT 
    job_id,
    submission,
    date_added,
    status,
    user_added,
    '<button type="button" class="t-Button t-Button--danger t-Button--small cancel-row" '||
    'data-jobid="'|| job_id ||'">Cancel</button>' cancel_button
FROM bulk_resolution_data
ORDER BY job_id DESC;




<button type="button" class="t-Button t-Button--danger t-Button--small cancel-row" data-jobid="106">Cancel</button>



DECLARE
    l_job_id NUMBER := APEX_APPLICATION.G_X01;
BEGIN
    -- Delete from child table first
    DELETE FROM bulk_resolution_data1
     WHERE job_id = l_job_id;

    -- Delete from header table
    DELETE FROM bulk_resolution_data
     WHERE job_id = l_job_id;

    COMMIT;

    -- Always return valid JSON
    owa_util.mime_header('application/json', FALSE);
    htp.p('{"status":"OK"}');
    owa_util.http_header_close;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        owa_util.mime_header('application/json', FALSE);
        htp.p('{"status":"ERROR","message":"' ||
              REPLACE(SQLERRM,'"','\"') || '"}');
        owa_util.http_header_close;
END;


DECLARE
    l_job_id NUMBER := APEX_APPLICATION.G_X01;
BEGIN
    -- Delete from child table first
    DELETE FROM bulk_resolution_data1
     WHERE job_id = l_job_id;

    -- Delete from header table
    DELETE FROM bulk_resolution_data
     WHERE job_id = l_job_id;

    COMMIT;

    -- Always return valid JSON
    owa_util.mime_header('application/json', FALSE);
    htp.p('{"status":"OK"}');
    owa_util.http_header_close;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        owa_util.mime_header('application/json', FALSE);
        htp.p('{"status":"ERROR","message":"' ||
              REPLACE(SQLERRM,'"','\"') || '"}');
        owa_util.http_header_close;
END;




$(".cancel-row").on("click", function(){
  var jobId = $(this).data("jobid");

  apex.server.process(
    "DELETE_JOB",                 // name of Ajax Callback
    {x01: jobId},                 // pass jobId to PL/SQL
    {
      dataType: "json",           // expect JSON now
      success: function(pData){
        if (pData.status === "OK"){
          apex.region("ir_bulk_jobs").refresh();
          apex.message.showPageSuccess("JOB_ID " + jobId + " deleted.");
        } else {
          apex.message.alert("Delete failed: " + pData.message);
        }
      },
      error: function(jqXHR, status, err){
        apex.message.alert("Ajax error: " + err);
      }
    }
  );
});