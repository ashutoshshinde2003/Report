DECLARE
    l_blob       BLOB;
    l_file_name  VARCHAR2(255);
BEGIN
    -- 1. Insert into BULK_RESOLUTION_DATA from page items
    INSERT INTO bulk_resolution_data (
        job_id,
        submission,
        date_added,
        status,
        user_added
    ) VALUES (
        :P5_NEW_1_JOBID,
        NULL, -- or put submission value if you have another page item
        :P5_NEW_1_DATE,
        :P5_NEW_2_STATUS,
        :P5_NEW_1_USERNAME
    );

    -- 2. Get latest uploaded Excel file from APEX temp files
    SELECT blob_content, filename
      INTO l_blob, l_file_name
      FROM (
             SELECT blob_content, filename
               FROM apex_application_temp_files
              WHERE application_id = :APP_ID
              ORDER BY created_on DESC
           )
     WHERE ROWNUM = 1;

    -- 3. Parse Excel data and insert into BULK_RESOLUTION_DATA1
    FOR rec IN (
        SELECT *
          FROM TABLE(
                 apex_data_parser.parse(
                     p_content   => l_blob,
                     p_file_name => l_file_name,
                     p_skip_rows => 1
                 )
               )
    )
    LOOP
        INSERT INTO bulk_resolution_data1 (
            case_id,
            job_id,
            status,
            case_status
        ) VALUES (
            rec.col001,   -- Excel col1 → CASE_ID
            :P5_NEW_1_JOBID, -- same job_id to link with first table
            rec.col002,   -- Excel col2 → STATUS
            rec.col003    -- Excel col3 → CASE_STATUS
        );
    END LOOP;

    -- 4. Clean up temp files
    DELETE FROM apex_application_temp_files
     WHERE filename = l_file_name;

    COMMIT;
END;