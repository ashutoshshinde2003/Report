DECLARE
    l_blob       BLOB;
    l_file_name  VARCHAR2(255);
BEGIN
    -- get latest uploaded file
    SELECT blob_content, filename
      INTO l_blob, l_file_name
      FROM (
             SELECT blob_content, filename
               FROM apex_application_temp_files
              WHERE application_id = :APP_ID
              ORDER BY created_on DESC
           )
     WHERE ROWNUM = 1;

    -- parse first sheet (Jobs)
    FOR rec IN (
        SELECT *
          FROM TABLE(
                 apex_data_parser.parse(
                     p_content    => l_blob,
                     p_file_name  => l_file_name,
                     p_sheet_index => 1,  -- 1 = first sheet
                     p_skip_rows  => 1    -- skip header row
                 )
               )
    )
    LOOP
        INSERT INTO bulk_resolution_data (
            job_id,
            submission,
            date_added,
            status,
            user_added
        )
        VALUES (
            rec.col001,  -- adjust mapping as per your Excel columns
            rec.col002,
            TO_DATE(rec.col003, 'DD-MM-YYYY'),
            rec.col004,
            rec.col005
        );
    END LOOP;

    DELETE FROM apex_application_temp_files
     WHERE filename = l_file_name;

    COMMIT;
END;




DECLARE
    l_blob       BLOB;
    l_file_name  VARCHAR2(255);
BEGIN
    -- get latest uploaded file
    SELECT blob_content, filename
      INTO l_blob, l_file_name
      FROM (
             SELECT blob_content, filename
               FROM apex_application_temp_files
              WHERE application_id = :APP_ID
              ORDER BY created_on DESC
           )
     WHERE ROWNUM = 1;

    -- parse second sheet (Cases)
    FOR rec IN (
        SELECT *
          FROM TABLE(
                 apex_data_parser.parse(
                     p_content    => l_blob,
                     p_file_name  => l_file_name,
                     p_sheet_index => 2,  -- 2 = second sheet
                     p_skip_rows  => 1
                 )
               )
    )
    LOOP
        INSERT INTO bulk_resolution_data1 (
            case_id,
            job_id,
            status,
            case_status
        )
        VALUES (
            rec.col001,  -- adjust mapping as per your Excel columns
            rec.col002,
            rec.col003,
            rec.col004
        );
    END LOOP;

    DELETE FROM apex_application_temp_files
     WHERE filename = l_file_name;

    COMMIT;
END;