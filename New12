// ======== File Browse Pre-Submit Validation (before loading spinner) ========
document.addEventListener("DOMContentLoaded", function () {

  const fileItemName = "P21_FILE_BROWSE"; // <-- your actual file browse item

  // helper to show message and highlight field
  function showFileError() {
    apex.message.clearErrors();
    apex.message.showErrors([{
      type: "error",
      location: "page",
      message: "Please select a file before submitting.",
      unsafe: false
    }]);

    const el = document.getElementById(fileItemName);
    if (el) {
      el.scrollIntoView({ behavior: "smooth", block: "center" });
      el.style.outline = "3px solid red";
      setTimeout(() => { el.style.outline = ""; }, 2000);
    }
  }

  // --- intercept BEFORE APEX triggers the spinner ---
  $(document).on("apexbeforepagesubmit", function (e, data) {
    const fileVal = $v(fileItemName);

    if (!fileVal || fileVal.trim() === "") {
      // Stop submit + prevent loading spinner
      e.preventDefault();
      e.stopImmediatePropagation();

      showFileError();
      return false;
    }

    // otherwise allow the spinner + submit to continue
    return true;
  });

});